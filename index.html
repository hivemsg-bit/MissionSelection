<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionSelection | करेंट अफेयर्स और सामान्य ज्ञान प्रश्नोत्तरी</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
        --primary-color: #4361ee;
        --primary-dark: #3a56d4;
        --color-correct: #28a745;
        --color-incorrect: #dc3545;
        --color-unattempted: #ffc107;
        --color-marked: #805ad5; 
        --color-not-answered: #c53030;
        --color-answered: #2f855a;
        --color-answered-marked: #2c5282;

        --bg-correct: #f0fff4;
        --bg-incorrect: #fff5f5;
        --bg-unattempted: #fffff0;
        --bg-marked: #faf5ff;
        --bg-not-answered: #fed7d7;
        --bg-answered: #c6f6d5;
        --bg-answered-marked: #bee3f8;
        --bg-not-visited: #edf2f7;

        --border-correct: #9ae6b4;
        --border-incorrect: #feb2b2;
        --border-unattempted: #fefcbf;
        --border-marked: #e9d8fd;
        --border-not-answered: #f56565;
        --border-answered: #68d391;
        --border-answered-marked: #90cdf4;
        --border-not-visited: #e2e8f0;
        
        --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05);
        --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

        --sidebar-width: 320px;
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        background-color: #f0f4f8;
        color: #2d3748;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .hidden { display: none !important; }

    .app-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 1rem;
    }

    .card {
        background-color: white;
        border-radius: 1rem;
        box-shadow: var(--shadow-xl);
        overflow: hidden;
        width: 100%;
    }

    /* --- Instructions Screen --- */
    .instructions-card { max-width: 800px; }
    .instructions-content { padding: 2rem; }
    .instructions-content h1 {
        font-size: 2rem;
        font-weight: 700;
        text-align: center;
        color: #1a202c;
        margin-bottom: 1.5rem;
    }
    .instructions-summary {
        background-color: #edf2f7;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid #e2e8f0;
        margin-bottom: 1.5rem;
    }
    .instructions-list {
        list-style: none;
        padding-left: 0;
        margin-bottom: 1.5rem;
    }
    .instructions-list li {
        padding-left: 1.5rem;
        position: relative;
        margin-bottom: 0.5rem;
    }
    .instructions-list li::before {
        content: '✔';
        position: absolute;
        left: 0;
        color: var(--primary-color);
    }
    .instructions-actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    @media(min-width: 640px) {
       .instructions-actions {
            flex-direction: row;
            justify-content: space-between;
       }
    }
    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    .btn-primary { background-color: var(--primary-color); color: white; }
    .btn-primary:hover { background-color: var(--primary-dark); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .btn-secondary { background-color: #e2e8f0; color: #4a5568; }
    .btn-secondary:hover { background-color: #cbd5e0; }
    .btn-tertiary { background-color: transparent; border: 1px solid var(--primary-color); color: var(--primary-color); }
    .btn-tertiary:hover { background-color: #f7fafc; }

    /* --- Quiz Screen --- */
    .quiz-container {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100vh;
        max-height: 100vh;
        max-width: 1600px;
    }
    .quiz-container.fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
        border-radius: 0;
    }

    .quiz-top-bar {
        background-color: var(--primary-color);
        color: white;
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: var(--shadow-md);
        z-index: 10;
    }
    .quiz-top-bar h1 { font-size: 1.125rem; font-weight: 600; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .top-bar-controls { display: flex; align-items: center; gap: 1rem; }
    .timer-display { 
        background-color: rgba(255,255,255,0.2); 
        padding: 0.5rem 1rem; 
        border-radius: 999px; 
        display: flex; 
        align-items: center; 
        gap: 0.5rem; 
        min-width: 100px;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    .timer-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        background-color: rgba(255,255,255,0.5);
        width: 100%;
        transform-origin: left;
        transition: transform 1s linear;
    }
    .control-btn { background: none; border: none; color: white; cursor: pointer; padding: 0.25rem; }
    .control-btn svg { width: 1.25rem; height: 1.25rem; }

    .quiz-main-area {
        display: flex;
        flex-grow: 1;
        overflow: hidden;
        position: relative;
    }
    .question-pane {
        flex-grow: 1;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
    }
    .question-header {
        background-color: #edf2f7;
        padding: 0.75rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .question-text { 
        font-size: 1.125rem; 
        font-weight: 600; 
        margin-bottom: 1.5rem; 
        line-height: 1.5;
    }
    .question-image {
        max-width: 100%;
        margin: 0.5rem 0 1.5rem;
        border-radius: 0.5rem;
        box-shadow: var(--shadow-md);
    }
    .options-grid { display: flex; flex-direction: column; gap: 0.75rem; }
    .option-btn {
        text-align: left;
        padding: 0.75rem 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 0.5rem;
        background-color: white;
        transition: all 0.2s ease-in-out;
        cursor: pointer;
        width: 100%;
        display: flex;
        align-items: flex-start;
        position: relative;
    }
    .option-btn:hover { border-color: var(--primary-color); background-color: #f7fafc; }
    .option-btn.selected {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-dark);
        font-weight: 600;
    }
    .option-btn.correct { background-color: var(--bg-correct); border-color: var(--border-correct); color: var(--color-answered); }
    .option-btn.incorrect { background-color: var(--bg-incorrect); border-color: var(--border-incorrect); color: var(--color-not-answered); }
    .option-btn .option-prefix {
        font-weight: 600;
        margin-right: 0.5rem;
        color: var(--primary-color);
        min-width: 24px;
    }
    .option-btn.selected .option-prefix { color: white; }
    .option-status-icon {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        display: none;
    }
    .option-btn.correct .option-status-icon.correct,
    .option-btn.incorrect .option-status-icon.incorrect {
        display: block;
    }

    .question-actions {
        margin-top: auto;
        padding-top: 1rem;
        border-top: 1px solid #e2e8f0;
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
    @media(min-width: 640px) { .question-actions { grid-template-columns: repeat(3, 1fr); } }

    .quiz-sidebar {
        width: var(--sidebar-width);
        background-color: #f7fafc;
        border-left: 1px solid #e2e8f0;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        transition: transform 0.3s ease-in-out, width 0.3s ease-in-out, padding 0.3s ease-in-out;
        overflow-y: auto;
    }
    .quiz-sidebar.collapsed {
        transform: translateX(100%);
        width: 0;
        padding: 0;
        border-left: none;
        overflow: hidden;
    }
    .sidebar-toggle {
        position: absolute;
        top: 50%;
        right: var(--sidebar-width);
        transform: translateY(-50%);
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 0.5rem 0 0 0.5rem;
        padding: 0.75rem 0.25rem;
        cursor: pointer;
        z-index: 5;
        transition: right 0.3s ease-in-out;
        box-shadow: var(--shadow-md);
    }
    .quiz-sidebar.collapsed + .sidebar-toggle { right: 0; }
    .sidebar-toggle svg { width: 1.25rem; height: 1.25rem; }

    .palette-header {
        text-align: center;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e2e8f0;
    }
    .question-palette {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    .palette-item {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid transparent;
        position: relative;
    }
    .palette-item.current {
        border-color: var(--primary-dark);
        transform: scale(1.1);
        box-shadow: var(--shadow-md);
    }
    .palette-item.correct { background-color: var(--bg-answered); border: 1px solid var(--border-answered); color: var(--color-answered); }
    .palette-item.incorrect { background-color: var(--bg-incorrect); border: 1px solid var(--border-incorrect); color: var(--color-incorrect); }
    .palette-item.unattempted { background-color: #f7fafc; border: 1px solid #e2e8f0; color: #4a5568; }

    /* Status summary in sidebar */
    .status-summary {
        background: white;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: var(--shadow-sm);
    }
    .status-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
    }
    .status-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        margin-right: 0.5rem;
    }

    /* Palette Status Colors */
    .status-notVisited { background-color: var(--bg-not-visited); border-color: var(--border-not-visited); color: #4a5568; }
    .status-notAnswered { background-color: var(--bg-not-answered); border-color: var(--border-not-answered); color: var(--color-not-answered); }
    .status-answered { background-color: var(--bg-answered); border-color: var(--border-answered); color: var(--color-answered); }
    .status-markedForReview { background-color: var(--bg-marked); border-color: var(--border-marked); color: var(--color-marked); position: relative; }
    .status-answeredAndMarked { background-color: var(--bg-answered-marked); border-color: var(--border-answered-marked); color: var(--color-answered-marked); position: relative; }

    .status-markedForReview::after, .status-answeredAndMarked::after {
        content: '';
        position: absolute;
        bottom: 4px;
        right: 4px;
        width: 8px;
        height: 8px;
        background-color: var(--color-marked);
        border-radius: 50%;
    }
    
    /* --- Results Screen --- */
    .results-card { max-width: 1000px; background-color: #f7fafc; }
    .results-content { padding: 2.5rem; }
    .results-header { text-align: center; margin-bottom: 2rem; }
    .results-header h1 { font-size: 2.5rem; font-weight: 700; color: #1a202c; }
    .feedback-card {
        padding: 1.5rem;
        border-radius: 0.75rem;
        margin: 1.5rem 0;
        text-align: center;
        border: 2px solid;
    }
    .feedback-card h2 { margin: 0 0 0.5rem 0; font-size: 1.75rem; }
    .feedback-card .score { font-size: 4rem; font-weight: 800; line-height: 1; }
    .feedback-card .percentage { font-size: 1.5rem; font-weight: 600; }
    
    .results-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin: 2rem 0;
    }
    @media(min-width: 768px) { .results-grid { grid-template-columns: repeat(2, 1fr); } }

    .summary-card {
        background-color: white;
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: var(--shadow-lg);
    }
    .summary-card h3 { margin-top: 0; font-size: 1.25rem; color: #2d3748; }
    .summary-list { list-style: none; padding: 0; }
    .summary-list li { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #edf2f7; }
    .summary-list li:last-child { border-bottom: none; }
    .css-bar { background-color: #e2e8f0; border-radius: 99px; height: 12px; overflow: hidden; }
    .css-bar-fill { height: 100%; border-radius: 99px; transition: width 0.8s ease-out; }
    .results-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
    }
    .social-card {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        text-align: center;
        padding: 1.5rem;
        border-radius: 0.75rem;
    }
    .social-card .btn { background-color: rgba(255,255,255,0.2); color: white; border: 1px solid white; }
    .social-card .btn:hover { background-color: rgba(255,255,255,0.3); }

    /* --- Review Screen --- */
    .review-card { max-width: 1400px; display: flex; flex-direction: column; height: calc(100vh - 2rem); }
    .review-top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1.5rem;
        background-color: #fff;
        border-bottom: 1px solid #e2e8f0;
        flex-shrink: 0;
    }
    .review-main-area { display: flex; flex: 1; overflow: hidden; }
    .review-question-pane { flex: 1; padding: 1.5rem; overflow-y: auto; }
    .review-sidebar { width: var(--sidebar-width); background: #f7fafc; border-left: 1px solid #e2e8f0; display: flex; flex-direction: column; overflow-y: auto; }
    
    .review-q-header { padding: 1rem; background-color: #edf2f7; border-radius: 0.5rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
    .review-q-status { display: flex; align-items: center; font-weight: 600; }
    .review-q-text { font-size: 1.125rem; font-weight: 600; margin-bottom: 1.5rem; }
    
    .review-option {
        border-width: 2px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1rem;
    }
    .review-option.user-selected {
        box-shadow: var(--shadow-md);
    }
    .review-option.correct {
        border-color: var(--color-correct);
        background-color: var(--bg-correct);
        color: var(--color-answered);
    }
    .review-option.incorrect {
        border-color: var(--color-incorrect);
        background-color: var(--bg-incorrect);
        color: var(--color-not-answered);
    }
    .review-option.not-selected {
         background-color: #f7fafc;
         border-color: #e2e8f0;
    }
    .review-explanation {
        margin-top: 1.5rem;
        padding: 1.5rem;
        background-color: #f0f9ff;
        border-left: 4px solid #3b82f6;
        border-radius: 0.25rem;
        animation: fadeIn 0.5s ease-in-out;
    }
    .review-explanation h4 { margin-top: 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1.1rem; color: #1e3a8a; }
    .review-actions {
        padding: 1.5rem 0 0 0;
        border-top: 1px solid #e2e8f0;
        margin-top: 1.5rem;
        display: flex;
        justify-content: space-between;
    }
    .review-sidebar-card { background: white; border-radius: 0.5rem; padding: 1rem; margin: 1rem; box-shadow: var(--shadow-sm); }
    .review-sidebar-card h4 { margin-top: 0; font-size: 1rem; text-align: center; }
    
    .toggle-switch {
        display: inline-flex;
        align-items: center;
        cursor: pointer;
    }
    .toggle-switch input { display: none; }
    .toggle-switch .slider {
        width: 44px; height: 24px;
        background-color: #a0aec0;
        border-radius: 9999px;
        position: relative;
        transition: background-color 0.2s;
    }
    .toggle-switch .slider::before {
        content: '';
        position: absolute;
        width: 16px; height: 16px;
        border-radius: 50%;
        background-color: white;
        top: 4px; left: 4px;
        transition: transform 0.2s;
    }
    .toggle-switch input:checked + .slider { background-color: var(--color-correct); }
    .toggle-switch input:checked + .slider::before { transform: translateX(20px); }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* New features */
    .quick-nav-buttons {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    .quick-nav-buttons .btn {
        flex: 1;
        padding: 0.5rem;
        font-size: 0.875rem;
    }
    
    .performance-chart {
        width: 100%;
        height: 200px;
        margin: 1.5rem 0;
    }
    
    .theme-toggle {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .theme-toggle:hover {
        background-color: rgba(255,255,255,0.1);
    }

    /* Dark theme */
    [data-theme="dark"] {
        --primary-color: #5a67d8;
        --primary-dark: #4c51bf;
        --bg-correct: #22543d;
        --bg-incorrect: #742a2a;
        --bg-unattempted: #744210;
        --bg-not-visited: #2d3748;
        --color-correct: #68d391;
        --color-incorrect: #fc8181;
        --color-unattempted: #f6e05e;
    }
    
    [data-theme="dark"] body {
        background-color: #1a202c;
        color: #e2e8f0;
    }
    
    [data-theme="dark"] .card {
        background-color: #2d3748;
        color: #e2e8f0;
    }
    
    [data-theme="dark"] .question-header,
    [data-theme="dark"] .instructions-summary,
    [data-theme="dark"] .quiz-sidebar,
    [data-theme="dark"] .review-sidebar {
        background-color: #2d3748;
        border-color: #4a5568;
    }
    
    [data-theme="dark"] .option-btn {
        background-color: #2d3748;
        border-color: #4a5568;
        color: #e2e8f0;
    }
    
    [data-theme="dark"] .option-btn:hover {
        background-color: #3c4666;
    }
    
    [data-theme="dark"] .summary-card,
    [data-theme="dark"] .review-sidebar-card {
        background-color: #2d3748;
        color: #e2e8f0;
    }

    /* Utility */
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .text-center { text-align: center; }
    .text-sm { font-size: 0.875rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mt-auto { margin-top: auto; }
    .svg-icon {
        display: inline-block;
        width: 1em;
        height: 1em;
        stroke-width: 0;
        stroke: currentColor;
        fill: currentColor;
        vertical-align: middle;
    }

  </style>
</head>
<body>
  
  <!-- SVG Icons Definition -->
  <svg class="hidden" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs>
      <symbol id="icon-play" viewBox="0 0 24 24" fill="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" /></symbol>
      <symbol id="icon-pause" viewBox="0 0 24 24" fill="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 5.25v13.5m-7.5-13.5v13.5" /></symbol>
      <symbol id="icon-fullscreen-enter" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9m5.25 11.25v-4.5m0 4.5h-4.5m4.5 0L15 15" /></symbol>
      <symbol id="icon-fullscreen-exit" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9V4.5M15 9h4.5M15 9l5.25-5.25M15 15v4.5M15 15h4.5M15 15l5.25 5.25" /></symbol>
      <symbol id="icon-chevron-left" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 19.5L8.25 12l7.5-7.5" /></symbol>
      <symbol id="icon-chevron-right" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></symbol>
      <symbol id="icon-check-circle" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></symbol>
      <symbol id="icon-x-circle" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></symbol>
      <symbol id="icon-minus-circle" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></symbol>
      <symbol id="icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></symbol>
      <symbol id="icon-lightbulb" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.311V21m0 0H9m3-3.75V6.75m0-3a3 3 0 00-3 3h6a3 3 0 00-3-3z" /></symbol>
      <symbol id="icon-youtube" viewBox="0 0 24 24"><path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.73,18.78 17.93,18.84C17.13,18.91 16.44,18.94 15.84,18.94L15,19C12.81,19 11.2,18.84 10.17,18.56C9.27,18.31 8.69,17.73 8.44,16.83C8.31,16.36 8.22,15.73 8.16,14.93C8.09,14.13 8.06,13.44 8.06,12.84L8,12C8,9.81 8.16,8.2 8.44,7.17C8.69,6.27 9.27,5.69 10.17,5.44C10.64,5.31 11.27,5.22 12.07,5.16C12.87,5.09 13.56,5.06 14.16,5.06L15,5C17.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z"></path></symbol>
      <symbol id="icon-telegram" viewBox="0 0 24 24"><path d="M9.78,18.65L10.26,14.21L18.73,7.45M9.78,18.65L12.73,17.54L14.21,15.07L12.06,17.03M9.78,18.65L6.29,17.3L3.09,16.1L3.18,16.27C3.43,16.77 3.63,17.26 3.76,17.74C3.92,18.31 3.96,18.83 3.96,19.31C3.96,19.31 4,19.31 4,19.32L4,19.33C4,19.73 4.07,20.13 4.22,20.5C4.39,20.88 4.62,21.23 4.93,21.53C5.23,21.83 5.59,22.07 5.97,22.24C6.34,22.41 6.73,22.5 7.12,22.5C7.5,22.5 7.85,22.42 8.17,22.27C8.48,22.11 8.77,21.89 9.03,21.63C9.29,21.37 9.5,21.07 9.66,20.75C9.83,20.42 9.91,20.05 9.91,19.65L9.78,18.65M18.73,7.45L7.05,12.92L3,11.62L20.94,4.69L18.73,7.45Z"></path></symbol>
      <symbol id="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></symbol>
      <symbol id="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></symbol>
    </defs>
  </svg>

  <div class="app-container">
    
    <div id="instructionsScreen" class="card instructions-card"></div>
    <div id="quizScreen" class="card quiz-container hidden"></div>
    <div id="resultsScreen" class="card results-card hidden"></div>
    <div id="reviewScreen" class="card review-card hidden"></div>

  </div>

  <script id="quiz-data" type="application/json">{"quizTitle":"करेंट अफेयर्स और सामान्य ज्ञान प्रश्नोत्तरी","questions":[{"id":0,"text":"नेपाल ने सरकार विरोधी प्रदर्शनों के पीड़ितों को श्रद्धांजली देने के लिए किस तारीख को 'राष्ट्रीय शोक दिवस' के रूप में मनाने की घोषणा की है?","options":["17 सितंबर","15 सितंबर","18 सितंबर","20 सितंबर"],"correctIndex":0,"explanation":"नेपाल ने सरकार विरोधी प्रदर्शनों के पीड़ितों को श्रद्धांजली देने के लिए 17 सितंबर को 'राष्ट्रीय शोक दिवस' के रूप में मनाने की घोषणा की है।","reference":"स्रोत: द हिमालयन टाइम्स, सितंबर 2025","image":""},{"id":1,"text":"केंद्रीय गृह मंत्री अमित शाह ने भारत के सबसे बड़े और अत्यधिक आधुनिक खेल परिसर का उद्घाटन किस शहर में किया है?","options":["नई दिल्ली","अहमदाबाद","मुंबई","चेन्नई"],"correctIndex":1,"explanation":"केंद्रीय गृह मंत्री अमित शाह ने अहमदाबाद में भारत के सबसे बड़े और अत्यधिक आधुनिक खेल परिसर का उद्घाटन किया है।","reference":"स्रोत: पीटीआई, सितंबर 2025","image":""},{"id":2,"text":"फ्रीडम एज सैन्य अभ्यास का आयोजन संयुक्त राज्य अमेरिका, दक्षिण कोरिया और किस देश द्वारा संयुक्त रूप से किया जाता है?","options":["भारत","चीन","जापान","ऑस्ट्रेलिया"],"correctIndex":2,"explanation":"फ्रीडम एज सैन्य अभ्यास का आयोजन संयुक्त राज्य अमेरिका, दक्षिण कोरिया और जापान द्वारा संयुक्त रूप से किया जाता है।","reference":"स्रोत: रॉयटर्स, सितंबर 2025","image":""},{"id":3,"text":"केन्द्रीय गृह मंत्री अमित शाह ने एंटी-नार्कोटिक्स टास्क फोर्स (ANTF) प्रमुखों के दूसरे राष्ट्रीय सम्मेलन के उद्घाटन सत्र को कहाँ संबोधित किया है?","options":["बेंगलुरु","कोलकाता","नई दिल्ली","हैदराबाद"],"correctIndex":2,"explanation":"केन्द्रीय गृह मंत्री अमित शाह ने नई दिल्ली में एंटी-नार्कोटिक्स टास्क फोर्स (ANTF) प्रमुखों के दूसरे राष्ट्रीय सम्मेलन के उद्घाटन सत्र को संबोधित किया है।","reference":"स्रोत: एएनआई, सितंबर 2025","image":""},{"id":4,"text":"हाल ही में भारतीय नौसेना ने समुद्री सुरक्षा मजबूत करने के लिए कौन-सा स्वदेशी युद्ध पोत अपने बेड़े में शामिल किया है?","options":["विक्रांत","शिवालिक","सह्याद्री","एंड्रोथ"],"correctIndex":3,"explanation":"हाल ही में भारतीय नौसेना ने समुद्री सुरक्षा मजबूत करने के लिए 'एंड्रोथ' नामक स्वदेशी युद्ध पोत को अपने बेड़े में शामिल किया है।","reference":"स्रोत: द हिंदू, सितंबर 2025","image":""},{"id":5,"text":"जुलाई, 2025 तक पूर्वोत्तर भारत में कितने किलोमीटर लंबे राष्ट्रीय राजमार्गों का निर्माण किया गया है?","options":["15,000 किलोमीटर","16,207 किलोमीटर","17,500 किलोमीटर","18,000 किलोमीटर"],"correctIndex":1,"explanation":"जुलाई, 2025 तक पूर्वोत्तर भारत में 16,207 किलोमीटर लंबे राष्ट्रीय राजमार्गों का निर्माण किया गया है।","reference":"स्रोत: पीआईबी, सितंबर 2025","image":""},{"id":6,"text":"अगस्त 2025 में थोक मूल्य सूचकांक (WPI) आधारित मुद्रास्फीति बढ़कर कितना प्रतिशत हो गई है?","options":["0.40%","0.52%","0.65%","0.70%"],"correctIndex":1,"explanation":"अगस्त 2025 में थोक मूल्य सूचकांक (WPI) आधारित मुद्रास्फीति बढ़कर 0.52% हो गई है।","reference":"स्रोत: वाणिज्य और उद्योग मंत्रालय, सितंबर 2025","image":""},{"id":7,"text":"भारतीय नौसेना जहाज कदमत्त, अपनी तीन महीने की तैनाती के हिस्से के रूप में एक सद्भावना यात्रा के लिए 15 सितंबर 2025 को किस देश पहुंचा है?","options":["मालदीव","श्रीलंका","फिजी","इंडोनेशिया"],"correctIndex":2,"explanation":"भारतीय नौसेना जहाज कदमत्त 15 सितंबर 2025 को एक सद्भावना यात्रा के लिए फिजी पहुंचा है।","reference":"स्रोत: इंडिया टुडे, सितंबर 2025","image":""},{"id":8,"text":"हाल ही में असम और पूर्वोत्तर भारत के कुछ हिस्सों में कितने तीव्रता का भूकंप आया?","options":["4.5","5.0","5.8","6.2"],"correctIndex":2,"explanation":"हाल ही में असम और पूर्वोत्तर भारत के कुछ हिस्सों में 5.8 तीव्रता का भूकंप आया था।","reference":"स्रोत: IMD, सितंबर 2025","image":""},{"id":9,"text":"हाल ही में किस देश में सबिता भंडारी को पहली महिला अटॉर्नी जनरल नियुक्त किया गया है?","options":["भारत","बांग्लादेश","नेपाल","भूटान"],"correctIndex":2,"explanation":"नेपाल में सबिता भंडारी को पहली महिला अटॉर्नी जनरल नियुक्त किया गया है।","reference":"स्रोत: काठमांडू पोस्ट, सितंबर 2025","image":""},{"id":10,"text":"पीएम विश्वकर्मा योजना वर्ष 2023 में किस तारीख को भारत सरकार द्वारा शुरू की गई थी?","options":["15 अगस्त","2 अक्टूबर","17 सितंबर","26 जनवरी"],"correctIndex":2,"explanation":"पीएम विश्वकर्मा योजना वर्ष 2023 में 17 सितंबर को भारत सरकार द्वारा शुरू की गई थी।","reference":"स्रोत: पीआईबी, सितंबर 2023","image":""},{"id":11,"text":"वर्तमान में केंद्र सरकार द्वारा कितने चिन्हित जिलों में नशा मुक्त भारत अभियान (एनएमबीए) चलाया जा रहा है?","options":["250 जिले","300 जिले","372 जिले","400 जिले"],"correctIndex":2,"explanation":"वर्तमान में केंद्र सरकार द्वारा 372 चिन्हित जिलों में नशा मुक्त भारत अभियान (एनएमबीए) चलाया जा रहा है।","reference":"स्रोत: एनडीटीवी, सितंबर 2025","image":""},{"id":12,"text":"भारत के सकल घरेलू उत्पाद (GDP) की उत्सर्जन तीव्रता वर्ष 2005 से 2020 के बीच कितने प्रतिशत कम हो गई है?","options":["25%","30%","36%","40%"],"correctIndex":2,"explanation":"भारत के सकल घरेलू उत्पाद (GDP) की उत्सर्जन तीव्रता वर्ष 2005 से 2020 के बीच 36% कम हो गई है。","reference":"स्रोत: पर्यावरण मंत्रालय, सितंबर 2025","image":""},{"id":13,"text":"हाल ही में किसको नई दिल्ली स्थित अखिल भारतीय आयुर्वेद संस्थान (एआईआईए) का नया निदेशक नियुक्त किया गया है?","options":["डॉ. रमेश चंद्र","प्रोफ़ेसर प्रदीप कुमार प्रजापति","डॉ. सुनीता वर्मा","प्रोफ़ेसर आलोक गुप्ता"],"correctIndex":1,"explanation":"प्रोफ़ेसर प्रदीप कुमार प्रजापति को नई दिल्ली स्थित अखिल भारतीय आयुर्वेद संस्थान (एआईआईए) का नया निदेशक नियुक्त किया गया है।","reference":"स्रोत: आयुष मंत्रालय, सितंबर 2025","image":""},{"id":14,"text":"वर्तमान में भारतीय ऑटो मोबाइल उद्योग कितने करोड़ से अधिक प्रत्यक्ष और अप्रत्यक्ष नौकरियों का सृजन करता है?","options":["10 मिलियन नौकरियां","20 मिलियन नौकरियां","30 मिलियन नौकरियां","35 मिलियन नौकरियां"],"correctIndex":3,"explanation":"वर्तमान में भारतीय ऑटो मोबाइल उद्योग 35 मिलियन से अधिक प्रत्यक्ष और अप्रत्यक्ष नौकरियों का सृजन करता है।","reference":"स्रोत: सियाम, सितंबर 2025","image":""},{"id":15,"text":"भारत में ब्रिटिश शासन की शुरुआत के संदर्भ में कौन-सा युद्ध महत्वपूर्ण है?","options":["बक्सर का युद्ध","प्लासी का युद्ध","पानीपत का तीसरा युद्ध","कर्नाटक युद्ध"],"correctIndex":1,"explanation":"भारत में ब्रिटिश शासन की शुरुआत के संदर्भ में प्लासी का युद्ध महत्वपूर्ण है।","reference":"स्रोत: एनसीईआरटी","image":""},{"id":16,"text":"भारतीय संविधान की कौन-सी अनुसूची राज्य सभा में सीटों के आवंटन से संबंधित है?","options":["तीसरी अनुसूची","चौथी अनुसूची","पांचवीं अनुसूची","छठी अनुसूची"],"correctIndex":1,"explanation":"भारतीय संविधान की चौथी अनुसूची राज्य सभा में सीटों के आवंटन से संबंधित है।","reference":"स्रोत: भारत का संविधान","image":""},{"id":17,"text":"किस दर्रे से होकर सतलज नदी भारत में प्रवेश करती है?","options":["नाथुला","लिपुलेख","शिपकी ला","जोजी ला"],"correctIndex":2,"explanation":"सतलज नदी शिपकी ला दर्रे से होकर भारत में प्रवेश करती है।","reference":"स्रोत: एनसीईआरटी भूगोल","image":""},{"id":18,"text":"किस इतिहासकार द्वारा समुद्रगुप्त को 'भारत का नेपोलियन' कहा गया?","options":["जेम्स मिल","वी. ए. स्मिथ","आर. सी. मजूमदार","आर. एस. शर्मा"],"correctIndex":1,"explanation":"वी. ए. स्मिथ नामक इतिहासकार द्वारा समुद्रगुप्त को 'भारत का नेपोलियन' कहा गया था।","reference":"स्रोत: एनसीईआरटी इतिहास","image":""},{"id":19,"text":"राज्यों में संवैधानिक तंत्र के विफल होने की स्थिति में किस अनुच्छेद के तहत 'राष्ट्रपति शासन' लगाया जाता है?","options":["अनुच्छेद 352","अनुच्छेद 356","अनुच्छेद 360","अनुच्छेद 368"],"correctIndex":1,"explanation":"राज्यों में संवैधानिक तंत्र के विफल होने की स्थिति में अनुच्छेद 356 के तहत 'राष्ट्रपति शासन' लगाया जाता है।","reference":"स्रोत: भारत का संविधान","image":""},{"id":20,"text":"भारतीय नौसेना जहाज कदमत्त की फिजी यात्रा का मुख्य उद्देश्य क्या था?","options":["एक नया सैन्य अड्डा स्थापित करना","व्यापारिक समझौते पर हस्ताक्षर करना","एक सद्भावना यात्रा","आपदा राहत कार्य में सहायता"],"correctIndex":2,"explanation":"भारतीय नौसेना जहाज कदमत्त, अपनी तीन महीने की तैनाती के हिस्से के रूप में एक सद्भावना यात्रा के लिए फिजी पहुंचा है। यह दर्शाता है कि यात्रा का मुख्य उद्देश्य सद्भावना था।","reference":"स्रोत: इंडिया टुडे, सितंबर 2025","image":""},{"id":21,"text":"केंद्रीय गृह मंत्री अमित शाह ने नई दिल्ली में किस प्रकार के सम्मेलन के उद्घाटन सत्र को संबोधित किया?","options":["पुलिस महानिदेशकों का वार्षिक सम्मेलन","एंटी-नार्कोटिक्स टास्क फोर्स (ANTF) प्रमुखों का दूसरा राष्ट्रीय सम्मेलन","राज्य के मुख्यमंत्रियों का सम्मेलन","पर्यावरण मंत्रियों का राष्ट्रीय सम्मेलन"],"correctIndex":1,"explanation":"केन्द्रीय गृह मंत्री अमित शाह ने नई दिल्ली में एंटी-नार्कोटिक्स टास्क फोर्स (ANTF) प्रमुखों के दूसरे राष्ट्रीय सम्मेलन के उद्घाटन सत्र को संबोधित किया है।","reference":"स्रोत: एएनआई, सितंबर 2025","image":""},{"id":22,"text":"करेंट अफेयर्स में उल्लिखित किस देश ने हाल ही में 'राष्ट्रीय शोक दिवस' घोषित किया और अपनी पहली महिला अटॉर्नी जनरल की नियुक्ति भी की?","options":["भारत","जापान","फिजी","नेपाल"],"correctIndex":3,"explanation":"नेपाल ने 17 सितंबर को 'राष्ट्रीय शोक दिवस' के रूप में मनाने की घोषणा की है (प्रश्न 1)। साथ ही, नेपाल में सबिता भंडारी को पहली महिला अटॉर्नी जनरल नियुक्त किया गया है (प्रश्न 10)। इस प्रकार, नेपाल दोनों घटनाओं से संबंधित है।","reference":"स्रोत: विभिन्न समाचार","image":""},{"id":23,"text":"करेंट अफेयर्स में उल्लिखित कौन से केंद्रीय मंत्री अहमदाबाद में एक खेल परिसर का उद्घाटन करने और नई दिल्ली में एक सम्मेलन को संबोधित करने में शामिल थे?","options":["राजनाथ सिंह","एस. जयशंकर","अमित शाह","निर्मला सीतारमण"],"correctIndex":2,"explanation":"पाठ में दो अलग-अलग घटनाओं का उल्लेख है जिनमें केंद्रीय गृह मंत्री अमित शाह शामिल थे: अहमदाबाद में भारत के सबसे बड़े और अत्यधिक आधुनिक खेल परिसर का उद्घाटन (प्रश्न 2) और नई दिल्ली में एंटी-नार्कोटिक्स टास्क फोर्स (ANTF) प्रमुखों के दूसरे राष्ट्रीय सम्मेलन के उद्घाटन सत्र को संबोधित करना (प्रश्न 4)।","reference":"स्रोत: विभिन्न समाचार","image":""},{"id":24,"text":"करेंट अफेयर्स में उल्लिखित कौन सी दो महत्वपूर्ण घटनाएँ 17 सितंबर को हुई थीं, लेकिन अलग-अलग वर्षों में (2025 और 2023)?","options":["नेपाल का राष्ट्रीय शोक दिवस और पीएम विश्वकर्मा योजना का शुभारंभ","अमित शाह द्वारा खेल परिसर का उद्घाटन और नशा मुक्त भारत अभियान का शुभारंभ","भारतीय नौसेना जहाज कदमत्त की फिजी यात्रा और असम में भूकंप","सबिता भंडारी की नियुक्ति और जीडीपी उत्सर्जन तीव्रता में कमी"],"correctIndex":0,"explanation":"नेपाल ने 17 सितंबर 2025 को 'राष्ट्रीय शोक दिवस' के रूप में मनाने की घोषणा की है (प्रश्न 1)। वहीं, पीएम विश्वकर्मा योजना वर्ष 2023 में 17 सितंबर को भारत सरकार द्वारा शुरू की गई थी (प्रश्न 11)। ये दोनों घटनाएँ 17 सितंबर को हुईं लेकिन अलग-अलग वर्षों में।","reference":"स्रोत: विभिन्न समाचार","image":""}],"totalTime":900,"negativeMarking":0.3333333333333333,"appName":"MissionSelection","youtubeLink":"","telegramLink":"https://t.me/MissionSelectionIndia","instructionStrings":{"screenTitle":"परीक्षा निर्देश","quizNamePrefix":"परीक्षा का नाम:","totalTime":"समय: 15 मिनट","totalMarks":"पूर्णांक: 25","instructionsHeader":"कृपया निम्नलिखित निर्देशों को ध्यानपूर्वक पढ़ें:","instruction1":"परीक्षा में 25 प्रश्न हैं।","instruction2":"प्रत्येक प्रश्न में दिए गए 4 विकल्पों में से केवल 1 विकल्प सही उत्तर के रूप में उपलब्ध होगा।","instruction3":"आपको परीक्षा समाप्त करने के लिए 15 मिनट का समय मिलेगा।","instruction4":"गलत उत्तर पर नकारात्मक अंकन है: प्रत्येक गलत उत्तर के लिए 0.33 अंक काटे जाएंगे।","instruction5":"प्रत्येक सही उत्तर के लिए 1 अंक दिया जाएगा।","instruction6":"प्रयास न किए गए प्रश्नों के लिए कोई अंक नहीं काटा जाएगा।","instruction7":"कृपया सुनिश्चित करें कि आप परीक्षा सबमिट करने से पहले या ब्राउज़र को बंद करने से पहले परीक्षा पूरी कर लें।","defaultLangMessage":"आपकी परीक्षा की डिफ़ॉल्ट भाषा है: हिन्दी","defaultLangDisclaimer":"सभी प्रश्न इसी भाषा में प्रदर्शित होंगे। इसे बाद में बदला नहीं जा सकता।","agreeCheckboxLabel":"मैंने सभी निर्देशों को ध्यान से पढ़ लिया है और समझ लिया है, और मैं उनका पालन करने के लिए सहमत हूं।","proceedButton":"मैं शुरू करने के लिए तैयार हूं","backButton":"पीछे जाएं"},"language":"hi"}</script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const S = { // State
            appPhase: 'instructions',
            questions: [],
            userAnswers: [],
            currentQuestionIndex: 0,
            timeLeft: 0,
            timerInterval: null,
            isTimerPaused: false,
            autoNext: true,
            isFullScreen: false,
            isSidebarCollapsed: true,
            quizResults: null,
            reviewIndex: 0,
            theme: 'light'
        };

        const C = JSON.parse(document.getElementById('quiz-data').textContent);
        C.QuestionStatus = { NotVisited: 'notVisited', NotAnswered: 'notAnswered', Answered: 'answered', MarkedForReview: 'markedForReview', AnsweredAndMarked: 'answeredAndMarked' };
        
        const root = document.querySelector('.app-container');

        // --- TEMPLATE RENDERERS ---
        const render = (template, target) => { target.innerHTML = template; };

        const instructionsTemplate = () => {
            const i = C.instructionStrings;
            return `
            <div class="instructions-content">
                <h1>${i.screenTitle}</h1>
                <div class="instructions-summary">
                    <p><strong>${i.quizNamePrefix}</strong> ${C.quizTitle}</p>
                    <p>${i.totalTime}</p>
                    <p>${i.totalMarks}</p>
                </div>
                <h2 class="font-bold mb-4">${i.instructionsHeader}</h2>
                <ul class="instructions-list">
                    <li>${i.instruction1}</li><li>${i.instruction2}</li><li>${i.instruction3}</li>
                    <li>${i.instruction4}</li><li>${i.instruction5}</li><li>${i.instruction6}</li>
                    <li>${i.instruction7}</li>
                </ul>
                <div class="instructions-summary">
                    <p class="font-bold">${i.defaultLangMessage}</p>
                    <p class="text-sm">${i.defaultLangDisclaimer}</p>
                </div>
                <label class="mb-4" style="display: flex; align-items: start; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" id="agreeCheckbox" style="margin-top: 4px;">
                    <span>${i.agreeCheckboxLabel}</span>
                </label>
                <div class="instructions-actions">
                    <button id="backButton" class="btn btn-secondary">${i.backButton}</button>
                    <button id="proceedButton" class="btn btn-primary" disabled>${i.proceedButton}</button>
                </div>
            </div>`;
        };

        const quizTemplate = () => `
            <div class="quiz-top-bar">
                <h1>${C.appName} - ${C.quizTitle}</h1>
                <div class="top-bar-controls">
                    <div class="timer-display">
                        <svg class="svg-icon" style="width:1.25rem;height:1.25rem;"><use href="#icon-clock"></use></svg>
                        <span id="timer">00:00</span>
                        <div class="timer-progress" id="timerProgress"></div>
                        <button id="pauseTimerBtn" class="control-btn" title="Pause Timer">
                            <svg class="svg-icon" id="pauseIcon"><use href="#icon-pause"></use></svg>
                            <svg class="svg-icon hidden" id="playIcon"><use href="#icon-play"></use></svg>
                        </button>
                    </div>
                    <label class="toggle-switch" title="Toggle Auto-Next">
                        <input type="checkbox" id="autoNextToggle" ${S.autoNext ? 'checked' : ''}>
                        <span class="slider"></span>
                    </label>
                    <button id="themeToggle" class="theme-toggle" title="Toggle Theme">
                        <svg class="svg-icon" id="themeIcon"><use href="#icon-${S.theme === 'light' ? 'moon' : 'sun'}"></use></svg>
                    </button>
                    <button id="fullscreenBtn" class="control-btn" title="Toggle Fullscreen">
                        <svg class="svg-icon" id="fullscreenEnterIcon"><use href="#icon-fullscreen-enter"></use></svg>
                        <svg class="svg-icon hidden" id="fullscreenExitIcon"><use href="#icon-fullscreen-exit"></use></svg>
                    </button>
                </div>
            </div>
            <div class="quiz-main-area">
                <div class="question-pane">
                    <div class="question-header">
                        <div>
                            <div id="questionNumber" class="font-bold"></div>
                            <div id="questionMarks" class="text-sm"></div>
                        </div>
                        <div id="questionStats" class="text-sm"></div>
                    </div>
                    <p id="questionText" class="question-text"></p>
                    <img id="questionImage" class="question-image hidden" src="" alt="Question image">
                    <div id="optionsContainer" class="options-grid"></div>
                    <div class="question-actions">
                        <button id="markReviewBtn" class="btn btn-secondary">Mark & Next</button>
                        <button id="clearResponseBtn" class="btn btn-secondary">Clear Response</button>
                        <button id="saveNextBtn" class="btn btn-primary"></button>
                    </div>
                    <div class="quick-nav-buttons">
                        <button id="firstQuestionBtn" class="btn btn-tertiary">First</button>
                        <button id="prevQuestionBtn" class="btn btn-tertiary">Previous</button>
                        <button id="nextQuestionBtn" class="btn btn-tertiary">Next</button>
                        <button id="lastQuestionBtn" class="btn btn-tertiary">Last</button>
                    </div>
                </div>
                <div id="quizSidebar" class="quiz-sidebar collapsed">
                    <h3 class="palette-header">Question Palette</h3>
                    <div class="status-summary">
                        <div class="status-item">
                            <div class="status-color" style="background-color: var(--bg-answered); border-color: var(--border-answered);"></div>
                            <span>Answered</span>
                        </div>
                        <div class="status-item">
                            <div class="status-color" style="background-color: var(--bg-not-answered); border-color: var(--border-not-answered);"></div>
                            <span>Not Answered</span>
                        </div>
                        <div class="status-item">
                            <div class="status-color" style="background-color: var(--bg-marked); border-color: var(--border-marked);"></div>
                            <span>Marked for Review</span>
                        </div>
                        <div class="status-item">
                            <div class="status-color" style="background-color: var(--bg-not-visited); border-color: var(--border-not-visited);"></div>
                            <span>Not Visited</span>
                        </div>
                    </div>
                    <div id="questionPalette" class="question-palette"></div>
                    <div class="mt-auto">
                        <button id="submitQuizBtn" class="btn btn-primary" style="width: 100%;">Submit Test</button>
                    </div>
                </div>
                <button id="sidebarToggle" class="sidebar-toggle" title="Toggle Sidebar">
                    <svg class="svg-icon"><use href="#icon-chevron-left"></use></svg>
                </button>
            </div>`;
        
        const resultsTemplate = () => {
            const r = S.quizResults;
            const feedback = getMotivationalFeedback(r.percentage);
            return `
            <div class="results-content">
                <div class="results-header"><h1>Quiz Results</h1></div>
                <div class="feedback-card" style="border-color: ${feedback.color}; background-color: ${feedback.bgColor};">
                    <h2 style="color: ${feedback.color};">${feedback.title}</h2>
                    <p>${feedback.message}</p>
                    <div class="score" style="color: ${feedback.color};">${r.score} / ${r.totalQuestions}</div>
                    <div class="percentage" style="color: ${feedback.color};">(${r.percentage}%)</div>
                </div>
                <div class="results-grid">
                    <div class="summary-card">
                        <h3>Score Summary</h3>
                        <ul class="summary-list">
                            <li><span>Total Questions:</span> <span class="font-semibold">${r.totalQuestions}</span></li>
                            <li style="color: var(--color-correct);"><span>Correct Answers:</span> <span class="font-semibold">${r.correct}</span></li>
                            <li style="color: var(--color-incorrect);"><span>Incorrect Answers:</span> <span class="font-semibold">${r.incorrect}</span></li>
                            <li style="color: var(--color-unattempted);"><span>Unattempted:</span> <span class="font-semibold">${r.unattempted}</span></li>
                            <li style="color: var(--color-incorrect);"><span>Negative Marking:</span> <span class="font-semibold">-${r.negativeMarksApplied.toFixed(2)}</span></li>
                        </ul>
                    </div>
                    <div class="summary-card">
                        <h3>Performance Breakdown</h3>
                        <div id="chart-container"></div>
                    </div>
                    <div class="summary-card social-card" style="grid-column: 1 / -1;">
                         <h3>Stay Connected!</h3>
                         <p>Join our channels for more quizzes and updates.</p>
                         <div style="display:flex; justify-content:center; gap:1rem; margin-top:1rem;">
                            <a href="${C.youtubeLink}" target="_blank" class="btn"><svg class="svg-icon" style="width:1.25rem;height:1.25rem;"><use href="#icon-youtube"></use></svg> YouTube</a>
                            <a href="${C.telegramLink}" target="_blank" class="btn"><svg class="svg-icon" style="width:1.25rem;height:1.25rem;"><use href="#icon-telegram"></use></svg> Telegram</a>
                         </div>
                    </div>
                </div>
                <div class="results-actions">
                    <button id="reviewAnswersBtn" class="btn btn-primary">View Solutions</button>
                    <button id="reattemptQuizBtn" class="btn btn-secondary">Re-attempt Quiz</button>
                    <button id="printResultsBtn" class="btn btn-tertiary">Print Results</button>
                </div>
            </div>`;
        };

        const reviewTemplate = () => `
            <div class="review-top-bar">
                <h2 class="font-bold">Review: ${C.quizTitle}</h2>
                <button id="exitReviewBtn" class="btn btn-secondary text-sm">Back to Results</button>
            </div>
            <div class="review-main-area">
                <div class="review-question-pane">
                     <div class="review-q-header">
                        <div id="reviewQuestionNumber" class="font-bold"></div>
                        <div id="reviewQuestionStatus" class="review-q-status"></div>
                    </div>
                    <p id="reviewQuestionText" class="review-q-text"></p>
                    <img id="reviewQuestionImage" class="question-image hidden" src="" alt="Question image">
                    <div id="reviewOptionsContainer" class="options-grid"></div>
                    <button id="toggleExplanationBtn" class="btn btn-secondary" style="margin-top: 1.5rem;">Show Solution</button>
                    <div id="reviewExplanation" class="review-explanation hidden">
                        <h4><svg class="svg-icon" style="width:1.25rem;height:1.25rem;"><use href="#icon-lightbulb"></use></svg>Explanation</h4>
                        <p id="explanationText"></p>
                        <p class="text-sm mt-4" id="referenceText"></p>
                    </div>
                     <div class="review-actions">
                        <button id="prevReviewBtn" class="btn btn-secondary">Previous</button>
                        <button id="nextReviewBtn" class="btn btn-secondary">Next</button>
                    </div>
                </div>
                <div class="review-sidebar">
                    <div class="review-sidebar-card">
                        <h4>Question Stats</h4>
                        <div id="review-sidebar-stats"></div>
                    </div>
                    <div class="review-sidebar-card" style="flex: 1; display: flex; flex-direction: column;">
                        <h4>Navigation</h4>
                        <div id="review-palette" class="question-palette" style="overflow-y: auto; flex: 1; align-content: flex-start;"></div>
                    </div>
                </div>
            </div>
            `;

        // --- CORE LOGIC ---
        function init() {
            S.questions = C.questions;
            S.timeLeft = C.totalTime;
            
            // Try to load saved state from localStorage
            const savedState = localStorage.getItem('quizState');
            if (savedState) {
                try {
                    const parsedState = JSON.parse(savedState);
                    if (confirm('We found a previous quiz in progress. Do you want to continue?')) {
                        Object.assign(S, parsedState);
                    }
                } catch (e) {
                    console.error('Error loading saved state:', e);
                }
            }
            
            showScreen('instructions');
        }

        function showScreen(screenName) {
            document.querySelectorAll('.card').forEach(s => s.classList.add('hidden'));
            const screenEl = document.getElementById(screenName + 'Screen');
            
            if (screenName === 'instructions') render(instructionsTemplate(), screenEl);
            if (screenName === 'quiz') render(quizTemplate(), screenEl);
            if (screenName === 'results') render(resultsTemplate(), screenEl);
            if (screenName === 'review') render(reviewTemplate(), screenEl);

            screenEl.classList.remove('hidden');
            S.appPhase = screenName;
            addEventListeners(); // Re-add listeners for new DOM
            
            if (screenName === 'quiz') postQuizRender();
            if (screenName === 'results') postResultsRender();
            if (screenName === 'review') postReviewRender();
        }

        // --- SCREEN-SPECIFIC LOGIC & LISTENERS ---
        function addEventListeners() {
            if (S.appPhase === 'instructions') {
                const agree = document.getElementById('agreeCheckbox');
                const proceed = document.getElementById('proceedButton');
                agree.onchange = () => { proceed.disabled = !agree.checked; };
                proceed.onclick = startQuiz;
                document.getElementById('backButton').onclick = () => window.close();
            } else if (S.appPhase === 'quiz') {
                document.getElementById('pauseTimerBtn').onclick = toggleTimerPause;
                document.getElementById('autoNextToggle').onchange = (e) => { S.autoNext = e.target.checked; saveState(); };
                document.getElementById('fullscreenBtn').onclick = toggleFullScreen;
                document.getElementById('markReviewBtn').onclick = handleMarkForReview;
                document.getElementById('clearResponseBtn').onclick = handleClearResponse;
                document.getElementById('saveNextBtn').onclick = handleSaveAndNext;
                document.getElementById('submitQuizBtn').onclick = submitQuiz;
                document.getElementById('sidebarToggle').onclick = toggleSidebar;
                document.getElementById('firstQuestionBtn').onclick = () => navigateToQuestion(0);
                document.getElementById('prevQuestionBtn').onclick = () => navigateToQuestion(S.currentQuestionIndex - 1);
                document.getElementById('nextQuestionBtn').onclick = () => navigateToQuestion(S.currentQuestionIndex + 1);
                document.getElementById('lastQuestionBtn').onclick = () => navigateToQuestion(S.questions.length - 1);
                document.getElementById('themeToggle').onclick = toggleTheme;
                
                // Add beforeunload event to warn user
                window.addEventListener('beforeunload', handleBeforeUnload);
            } else if (S.appPhase === 'results') {
                document.getElementById('reviewAnswersBtn').onclick = startReview;
                document.getElementById('reattemptQuizBtn').onclick = startQuiz;
                document.getElementById('printResultsBtn').onclick = printResults;
            } else if (S.appPhase === 'review') {
                document.getElementById('exitReviewBtn').onclick = () => showScreen('results');
                document.getElementById('prevReviewBtn').onclick = () => navigateReview(-1);
                document.getElementById('nextReviewBtn').onclick = () => navigateReview(1);
                document.getElementById('toggleExplanationBtn').onclick = toggleExplanation;
            }
        }

        function removeEventListeners() {
            window.removeEventListener('beforeunload', handleBeforeUnload);
        }

        function handleBeforeUnload(e) {
            if (S.appPhase === 'quiz') {
                e.preventDefault();
                e.returnValue = 'Your quiz progress will be lost if you leave. Are you sure?';
                return e.returnValue;
            }
        }

        function startQuiz() {
            S.currentQuestionIndex = 0;
            S.timeLeft = C.totalTime;
            S.userAnswers = S.questions.map(q => ({
                questionId: q.id, selectedOptionIndex: null, status: C.QuestionStatus.NotVisited, isMarked: false,
            }));
            S.userAnswers[0].status = C.QuestionStatus.NotAnswered;
            showScreen('quiz');
            
            // Clear any saved state when starting a new quiz
            localStorage.removeItem('quizState');
            
            // Try to enter fullscreen
            document.documentElement.requestFullscreen().catch(err => {
                console.warn(`Could not automatically enter fullscreen: ${err.message}`);
            });
        }

        function postQuizRender() {
            updateTimerDisplay();
            renderQuestion();
            renderPalette();
            if (!S.timerInterval) startTimer();
            updateQuestionStats();
        }

        function renderQuestion() {
            const q = S.questions[S.currentQuestionIndex];
            if (!q) return;
            document.getElementById('questionNumber').textContent = `Question ${S.currentQuestionIndex + 1} of ${S.questions.length}`;
            document.getElementById('questionMarks').textContent = `Marks: +1.00 / -${C.negativeMarking.toFixed(2)}`;
            document.getElementById('questionText').textContent = q.text;
            
            // Handle question image if available
            const questionImage = document.getElementById('questionImage');
            if (q.image) {
                questionImage.src = q.image;
                questionImage.classList.remove('hidden');
            } else {
                questionImage.classList.add('hidden');
            }
            
            const opts = document.getElementById('optionsContainer');
            opts.innerHTML = '';
            const answer = S.userAnswers[S.currentQuestionIndex];
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                if (answer.selectedOptionIndex === i) btn.classList.add('selected');
                btn.innerHTML = `
                    <span class="option-prefix">${String.fromCharCode(65 + i)}.</span>
                    <span>${opt}</span>
                    <svg class="option-status-icon correct" style="color: var(--color-correct);"><use href="#icon-check-circle"></use></svg>
                    <svg class="option-status-icon incorrect" style="color: var(--color-incorrect);"><use href="#icon-x-circle"></use></svg>
                `;
                btn.onclick = () => selectOption(i);
                opts.appendChild(btn);
            });
            document.getElementById('saveNextBtn').textContent = (S.currentQuestionIndex === S.questions.length - 1) ? 'Save & Finish' : 'Save & Next';
            
            // Update navigation buttons state
            document.getElementById('firstQuestionBtn').disabled = S.currentQuestionIndex === 0;
            document.getElementById('prevQuestionBtn').disabled = S.currentQuestionIndex === 0;
            document.getElementById('nextQuestionBtn').disabled = S.currentQuestionIndex === S.questions.length - 1;
            document.getElementById('lastQuestionBtn').disabled = S.currentQuestionIndex === S.questions.length - 1;
        }

        function updateQuestionStats() {
            const answered = S.userAnswers.filter(a => a.status === C.QuestionStatus.Answered || a.status === C.QuestionStatus.AnsweredAndMarked).length;
            const notAnswered = S.userAnswers.filter(a => a.status === C.QuestionStatus.NotAnswered).length;
            const marked = S.userAnswers.filter(a => a.status === C.QuestionStatus.MarkedForReview || a.status === C.QuestionStatus.AnsweredAndMarked).length;
            const notVisited = S.userAnswers.filter(a => a.status === C.QuestionStatus.NotVisited).length;
            
            document.getElementById('questionStats').textContent = 
                `Answered: ${answered} | Not Answered: ${notAnswered} | Marked: ${marked} | Not Visited: ${notVisited}`;
        }

        function renderPalette() {
            const p = document.getElementById('questionPalette');
            p.innerHTML = '';
            S.userAnswers.forEach((ans, i) => {
                const item = document.createElement('div');
                item.className = `palette-item status-${ans.status}`;
                if (i === S.currentQuestionIndex) item.classList.add('current');
                item.textContent = i + 1;
                item.onclick = () => navigateToQuestion(i);
                p.appendChild(item);
            });
        }
        
        function selectOption(index) {
            const answer = S.userAnswers[S.currentQuestionIndex];
            answer.selectedOptionIndex = index;
            answer.status = answer.isMarked ? C.QuestionStatus.AnsweredAndMarked : C.QuestionStatus.Answered;
            renderQuestion(); 
            renderPalette();
            updateQuestionStats();
            saveState();
            
            if (S.autoNext && S.currentQuestionIndex < S.questions.length - 1) {
                setTimeout(() => navigateToQuestion(S.currentQuestionIndex + 1), 300);
            }
        }

        function navigateToQuestion(index) {
            if (index < 0 || index >= S.questions.length) return;
            if (index === S.currentQuestionIndex) return;
            S.currentQuestionIndex = index;
            const answer = S.userAnswers[index];
            if (answer.status === C.QuestionStatus.NotVisited) answer.status = C.QuestionStatus.NotAnswered;
            renderQuestion(); 
            renderPalette();
            updateQuestionStats();
            saveState();
        }
        
        function handleSaveAndNext() {
            if (S.currentQuestionIndex < S.questions.length - 1) navigateToQuestion(S.currentQuestionIndex + 1);
            else submitQuiz();
        }
        
        function handleMarkForReview() {
            const answer = S.userAnswers[S.currentQuestionIndex];
            answer.isMarked = !answer.isMarked;
            answer.status = answer.selectedOptionIndex !== null ? (answer.isMarked ? C.QuestionStatus.AnsweredAndMarked : C.QuestionStatus.Answered) : (answer.isMarked ? C.QuestionStatus.MarkedForReview : C.QuestionStatus.NotAnswered);
            handleSaveAndNext();
            saveState();
        }
        
        function handleClearResponse() {
            const answer = S.userAnswers[S.currentQuestionIndex];
            answer.selectedOptionIndex = null;
            answer.status = answer.isMarked ? C.QuestionStatus.MarkedForReview : C.QuestionStatus.NotAnswered;
            renderQuestion(); 
            renderPalette();
            updateQuestionStats();
            saveState();
        }

        function submitQuiz() {
            if (confirm('Are you sure you want to submit the test?')) {
                stopTimer();
                calculateResults();
                removeEventListeners();
                localStorage.removeItem('quizState');
                showScreen('results');
            }
        }

        // --- TIMER ---
        function startTimer() { 
            stopTimer(); 
            S.timerInterval = setInterval(tick, 1000); 
        }
        
        function stopTimer() { 
            clearInterval(S.timerInterval); 
            S.timerInterval = null; 
        }
        
        function tick() {
            if (S.isTimerPaused) return;
            S.timeLeft--;
            updateTimerDisplay();
            if (S.timeLeft <= 0) { 
                alert('Time is up!'); 
                submitQuiz(); 
            }
        }
        
        function updateTimerDisplay() {
            const mins = Math.floor(S.timeLeft / 60).toString().padStart(2, '0');
            const secs = (S.timeLeft % 60).toString().padStart(2, '0');
            const timerEl = document.getElementById('timer');
            if (timerEl) timerEl.textContent = `${mins}:${secs}`;
            
            // Update progress bar
            const progressEl = document.getElementById('timerProgress');
            if (progressEl) {
                const progress = 100 - (S.timeLeft / C.totalTime * 100);
                progressEl.style.transform = `scaleX(${progress / 100})`;
            }
        }
        
        function toggleTimerPause() {
            S.isTimerPaused = !S.isTimerPaused;
            document.getElementById('pauseIcon').classList.toggle('hidden', S.isTimerPaused);
            document.getElementById('playIcon').classList.toggle('hidden', !S.isTimerPaused);
            saveState();
        }
        
        // --- STATE MANAGEMENT ---
        function saveState() {
            const stateToSave = {
                userAnswers: S.userAnswers,
                currentQuestionIndex: S.currentQuestionIndex,
                timeLeft: S.timeLeft,
                isTimerPaused: S.isTimerPaused,
                autoNext: S.autoNext,
                theme: S.theme
            };
            localStorage.setItem('quizState', JSON.stringify(stateToSave));
        }
        
        // --- RESULTS ---
        function calculateResults() {
            let correct = 0, incorrect = 0, unattempted = 0, score = 0, negativeMarksApplied = 0;
            S.userAnswers.forEach((ua, i) => {
                const q = S.questions[i];
                if (ua.selectedOptionIndex === null) unattempted++;
                else if (ua.selectedOptionIndex === q.correctIndex) { correct++; score++; } 
                else { incorrect++; score -= C.negativeMarking; negativeMarksApplied += C.negativeMarking; }
            });
            score = Math.max(0, score);
            const total = S.questions.length;
            const percentage = total > 0 ? (score / total) * 100 : 0;
            S.quizResults = { 
                correct, 
                incorrect, 
                unattempted, 
                score: score.toFixed(2), 
                percentage: percentage.toFixed(1), 
                totalQuestions: total, 
                negativeMarksApplied 
            };
        }

        function getMotivationalFeedback(percentage) {
            if (percentage >= 85) return { title: "Outstanding!", message: "Future Officer, you have a strong grasp of the material.", color: 'var(--color-correct)', bgColor: 'var(--bg-correct)' };
            if (percentage >= 70) return { title: "Great Job!", message: "You're on the right track. Review your mistakes!", color: '#4361ee', bgColor: '#e0e7ff' };
            if (percentage >= 50) return { title: "Solid Effort!", message: "There's room for improvement. Keep practicing!", color: 'var(--color-unattempted)', bgColor: 'var(--bg-unattempted)' };
            return { title: "Keep Going!", message: "Don't be discouraged! This is a learning opportunity.", color: 'var(--color-incorrect)', bgColor: 'var(--bg-incorrect)' };
        }

        function postResultsRender() {
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = '';
            const data = [
                { label: 'Correct', value: S.quizResults.correct, color: 'var(--color-correct)' },
                { label: 'Incorrect', value: S.quizResults.incorrect, color: 'var(--color-incorrect)' },
                { label: 'Unattempted', value: S.quizResults.unattempted, color: 'var(--color-unattempted)' }
            ];
            data.forEach(item => {
                const barWrapper = document.createElement('div');
                barWrapper.style.marginBottom = '1rem';
                const percent = (item.value / S.quizResults.totalQuestions) * 100;
                barWrapper.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                        <span class="font-semibold text-sm" style="color: ${item.color};">${item.label}</span>
                        <span class="text-sm font-medium">${item.value} / ${S.quizResults.totalQuestions}</span>
                    </div>
                    <div class="css-bar">
                        <div class="css-bar-fill" style="width: 0%; background: ${item.color};" data-percent="${percent}"></div>
                    </div>
                `;
                chartContainer.appendChild(barWrapper);
            });
            // Animate bars
            setTimeout(() => {
                document.querySelectorAll('.css-bar-fill').forEach(bar => {
                    bar.style.width = bar.getAttribute('data-percent') + '%';
                });
            }, 100);
        }

        function printResults() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>${C.quizTitle} - Results</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #333; }
                        .result-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
                        .summary-item { display: flex; justify-content: space-between; margin-bottom: 8px; }
                        .correct { color: green; }
                        .incorrect { color: red; }
                    </style>
                </head>
                <body>
                    <h1>${C.quizTitle} - Results</h1>
                    <div class="result-card">
                        <h2>Score: ${S.quizResults.score} / ${S.quizResults.totalQuestions} (${S.quizResults.percentage}%)</h2>
                        <div class="summary-item"><span>Correct Answers:</span> <span class="correct">${S.quizResults.correct}</span></div>
                        <div class="summary-item"><span>Incorrect Answers:</span> <span class="incorrect">${S.quizResults.incorrect}</span></div>
                        <div class="summary-item"><span>Unattempted:</span> ${S.quizResults.unattempted}</div>
                        <div class="summary-item"><span>Negative Marking:</span> <span class="incorrect">-${S.quizResults.negativeMarksApplied.toFixed(2)}</span></div>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }

        // --- REVIEW ---
        function startReview() { S.reviewIndex = 0; showScreen('review'); }
        
        function postReviewRender() {
            renderReviewQuestion();
            renderReviewPalette();
        }

        function renderReviewQuestion() {
            const q = S.questions[S.reviewIndex];
            const ua = S.userAnswers[S.reviewIndex];
            
            const statusInfo = ua.selectedOptionIndex === null ? { text: 'Unattempted', color: 'var(--color-unattempted)', icon: 'minus-circle' }
                             : ua.selectedOptionIndex === q.correctIndex ? { text: 'Correct', color: 'var(--color-correct)', icon: 'check-circle' }
                             : { text: 'Incorrect', color: 'var(--color-incorrect)', icon: 'x-circle' };

            document.getElementById('reviewQuestionNumber').textContent = `Question ${S.reviewIndex + 1} of ${S.questions.length}`;
            const statusEl = document.getElementById('reviewQuestionStatus');
            statusEl.innerHTML = `<svg class="svg-icon" style="width:1.25rem;height:1.25rem; margin-right: 0.5rem;"><use href="#icon-${statusInfo.icon}"></use></svg> ${statusInfo.text}`;
            statusEl.style.color = statusInfo.color;

            document.getElementById('reviewQuestionText').textContent = q.text;
            
            // Handle question image if available
            const questionImage = document.getElementById('reviewQuestionImage');
            if (q.image) {
                questionImage.src = q.image;
                questionImage.classList.remove('hidden');
            } else {
                questionImage.classList.add('hidden');
            }
            
            const opts = document.getElementById('reviewOptionsContainer');
            opts.innerHTML = '';
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'option-btn review-option';
                
                const isCorrect = i === q.correctIndex;
                const isUserSelected = i === ua.selectedOptionIndex;

                if (isCorrect) {
                    div.classList.add('correct');
                } else if (isUserSelected) {
                    div.classList.add('incorrect');
                } else {
                    div.classList.add('not-selected');
                }
                if(isUserSelected) div.classList.add('user-selected');

                let iconHtml = '';
                if (isCorrect) iconHtml = `<svg class="svg-icon" style="width:1.5rem;height:1.5rem;color:var(--color-correct);"><use href="#icon-check-circle"></use></svg>`;
                if (isUserSelected && !isCorrect) iconHtml = `<svg class="svg-icon" style="width:1.5rem;height:1.5rem;color:var(--color-incorrect);"><use href="#icon-x-circle"></use></svg>`;

                div.innerHTML = `<div><span class="option-prefix">${String.fromCharCode(65 + i)}.</span><span>${opt}</span></div> ${iconHtml}`;
                opts.appendChild(div);
            });
            document.getElementById('explanationText').textContent = q.explanation;
            document.getElementById('referenceText').textContent = q.reference ? `Reference: ${q.reference}` : '';
            document.getElementById('prevReviewBtn').disabled = S.reviewIndex === 0;
            document.getElementById('nextReviewBtn').disabled = S.reviewIndex === S.questions.length - 1;

            // Update sidebar stats
            document.getElementById('review-sidebar-stats').innerHTML = `
                <ul class="summary-list text-sm">
                    <li><span>Status:</span> <span class="font-semibold" style="color: ${statusInfo.color};">${statusInfo.text}</span></li>
                </ul>
            `;
        }

        function renderReviewPalette() {
            const palette = document.getElementById('review-palette');
            palette.innerHTML = '';
            S.questions.forEach((q, i) => {
                const ua = S.userAnswers[i];
                const item = document.createElement('div');
                item.className = 'palette-item';
                
                if (ua.selectedOptionIndex === null) item.classList.add('unattempted');
                else if (ua.selectedOptionIndex === q.correctIndex) item.classList.add('correct');
                else item.classList.add('incorrect');
                
                if (i === S.reviewIndex) item.classList.add('current');
                
                item.textContent = i + 1;
                item.onclick = () => {
                     S.reviewIndex = i;
                     renderReviewQuestion();
                     renderReviewPalette(); // To update the 'current' item
                     document.getElementById('reviewExplanation').classList.add('hidden');
                     document.getElementById('toggleExplanationBtn').textContent = 'Show Solution';
                };
                palette.appendChild(item);
            });
        }


        function navigateReview(dir) {
            const newIndex = S.reviewIndex + dir;
            if (newIndex >= 0 && newIndex < S.questions.length) {
                S.reviewIndex = newIndex;
                renderReviewQuestion();
                renderReviewPalette();
                document.getElementById('reviewExplanation').classList.add('hidden');
                document.getElementById('toggleExplanationBtn').textContent = 'Show Solution';
            }
        }
        
        function toggleExplanation() {
            const exp = document.getElementById('reviewExplanation');
            const btn = document.getElementById('toggleExplanationBtn');
            const isHidden = exp.classList.toggle('hidden');
            btn.textContent = isHidden ? 'Show Solution' : 'Hide Solution';
        }

        // --- HELPERS ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(err => console.error(err));
            else if (document.exitFullscreen) document.exitFullscreen();
        }
        
        document.addEventListener('fullscreenchange', () => {
            S.isFullScreen = !!document.fullscreenElement;
            document.querySelector('.quiz-container').classList.toggle('fullscreen', S.isFullScreen);
            document.getElementById('fullscreenEnterIcon').classList.toggle('hidden', S.isFullScreen);
            document.getElementById('fullscreenExitIcon').classList.toggle('hidden', !S.isFullScreen);
        });
        
        function toggleSidebar() {
            S.isSidebarCollapsed = !S.isSidebarCollapsed;
            const sb = document.getElementById('quizSidebar');
            const sbt = document.getElementById('sidebarToggle');
            sb.classList.toggle('collapsed', S.isSidebarCollapsed);
            sbt.innerHTML = S.isSidebarCollapsed ? `<svg class="svg-icon"><use href="#icon-chevron-left"></use></svg>` : `<svg class="svg-icon"><use href="#icon-chevron-right"></use></svg>`;
        }
        
        function toggleTheme() {
            S.theme = S.theme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', S.theme);
            document.getElementById('themeIcon').innerHTML = `<use href="#icon-${S.theme === 'light' ? 'moon' : 'sun'}"></use>`;
            saveState();
        }

        init();
    });
  </script>
</body>
</html>
